<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" href="style.css">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UNO for Two</title>
</head>
<body>
    <div id="container"></div>
    <div id="plus">+1</div>
    <div class="lastCenter">
        <div id="last"></div>
    </div>
    <script>
        const lastDiv = document.getElementById('last');
         const socket =new WebSocket('ws://localhost:3000');
        const container = document.getElementById('container')
        const plus = document.getElementById('plus')
         let myCard = [];
         let order = -1;
         function clearAll(op){
            if (op === 1 ) ;
            else {op.div.style.display = 'none';
            myCard.splice(myCard.indexOf(op) , 1);}
            plus.style.border = 'none';
            plus.onclick = null;
            myCard.forEach(element => {
                element.div.style.border = 'none';
                element.div.onclick = null;
            })
         }
         function playAcard(op) {
            op.div.onclick = () => {
                socket.send(JSON.stringify({
                    type:'play',
                    indexOfplayer:order,
                    indexOfCard:myCard.indexOf(op),
                    number:op.number,
                    color:op.color,
                }))
                console.log('hi')
                clearAll(op);
                
            }
         }
         function helpCard(){
            plus.style.border = '1px solid black',
            plus.onclick = () => {
                socket.send(JSON.stringify({
                    type:'help',
                    typeOfHelp: 'normal',
                    indexOfplayer:order
                }))
                clearAll(1)
            }
         }
         function blackCard(cardOpj){
            const blackCard = cardOpj.div;
            blackCard.onclick = () => {
                blackCard.onclick = null;
                const colors = ['red','yellow', 'blue','green'];
                colors.forEach(color => {
                    const colorDiv = document.createElement('div');
                    colorDiv.style.backgroundColor = color;
                    colorDiv.style.width = '50px';
                    colorDiv.style.height = '50px';
                    colorDiv.onclick = ()=> {
                    socket.send(JSON.stringify({
                    type:'play',
                    indexOfplayer:order,
                    indexOfCard:myCard.indexOf(cardOpj),
                    number:cardOpj.number,
                    color:color,

                }))
                clearAll(cardOpj);
                    }
                    blackCard.appendChild(colorDiv)
                })
            }
         }
         function creatDiv (father , text , Color , background)
         {
            const newDiv = document.createElement('div');
            newDiv.textContent = text;
            newDiv.style.color = Color;
            newDiv.style.backgroundColor = background;
            father.appendChild(newDiv);
            return newDiv;
         }
         socket.onopen = () => {}
         socket.onmessage = (event) => {
            const data = JSON.parse(event.data);
            if (data.type === 'order')order = data.order;
            if (data.type === 'playNow')
            {
                helpCard();
                console.log(data.index)
                data.index.forEach(index => {
                    const PlayDiv = myCard[index];
                    PlayDiv.div.style.border = '1px solid black';
                    if (PlayDiv.color === 'black') blackCard(PlayDiv);
                    else playAcard(PlayDiv);
                })
            }
            if (data.type === 'cards')
            {
                data.cards.forEach(card => {
                myCard.push({div:creatDiv(container , card.n , card.c), color:card.c , number:card.n});
                })
            }
            if (data.type === 'lastcard')
            {
                lastDiv.textContent = data.card.number;
                lastDiv.style.color = data.card.color;
                lastDiv.style.backgroundColor = 'gray';
            }
            if (data.type === "winner")
            {
                alert('you are the winner')
            }
            if (data.type === 'loser')
            {
                alert('you are the loser fuck you')
            }
         }
    </script>
</body>
</html>